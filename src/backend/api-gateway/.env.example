# API Gateway Environment Configuration
# ==========================================

# Service Configuration
NODE_ENV=development
SERVICE_NAME=api-gateway
PORT=3000
API_VERSION=v1
LOG_LEVEL=info
ENABLE_SWAGGER=true

# Gateway Configuration
GATEWAY_TIMEOUT=30000
GATEWAY_RETRY_ATTEMPTS=3
GATEWAY_RETRY_DELAY=1000
MAX_REDIRECTS=5
ENABLE_REQUEST_LOGGING=true
ENABLE_RESPONSE_LOGGING=false

# Service Endpoints
AUTH_SERVICE_URL=http://auth-service:3001
ENROLLMENT_SERVICE_URL=http://enrollment-service:3002
HEALTH_SERVICE_URL=http://health-service:3003
USER_SERVICE_URL=http://user-service:3004
POLICY_SERVICE_URL=http://policy-service:3005
DOCUMENT_SERVICE_URL=http://document-service:3006
PAYMENT_SERVICE_URL=http://payment-service:3007
NOTIFICATION_SERVICE_URL=http://notification-service:3010

# Service Health Check Configuration
HEALTH_CHECK_INTERVAL=30000
HEALTH_CHECK_TIMEOUT=5000
HEALTH_CHECK_UNHEALTHY_THRESHOLD=3
HEALTH_CHECK_HEALTHY_THRESHOLD=2

# Redis Configuration (Rate Limiting & Caching)
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=your-redis-password
REDIS_DB=2
REDIS_KEY_PREFIX=gateway:
REDIS_CONNECT_TIMEOUT=10000

# JWT Configuration
JWT_SECRET=your-jwt-secret-here-min-32-characters
JWT_ISSUER=austa-onboarding
JWT_AUDIENCE=austa-services
JWT_ALGORITHM=HS256
JWT_VERIFY=true
JWT_IGNORE_EXPIRATION=false

# Rate Limiting Configuration
RATE_LIMIT_ENABLED=true
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100
RATE_LIMIT_SKIP_SUCCESSFUL_REQUESTS=false
RATE_LIMIT_STORE=redis

# Route-Specific Rate Limits
RATE_LIMIT_AUTH_MAX=10
RATE_LIMIT_ENROLLMENT_MAX=50
RATE_LIMIT_HEALTH_MAX=30
RATE_LIMIT_POLICY_MAX=50
RATE_LIMIT_DOCUMENT_MAX=20
RATE_LIMIT_PAYMENT_MAX=10

# CORS Configuration
CORS_ORIGIN=https://*.austa.com.br,http://localhost:3000
CORS_CREDENTIALS=true
CORS_METHODS=GET,POST,PUT,DELETE,PATCH,OPTIONS
CORS_ALLOWED_HEADERS=Content-Type,Authorization,X-CSRF-Token,X-Request-ID
CORS_EXPOSED_HEADERS=X-Request-ID,X-RateLimit-Limit,X-RateLimit-Remaining
CORS_MAX_AGE=3600
CORS_PREFLIGHT_CONTINUE=false

# Security Configuration
HELMET_ENABLED=true
CSRF_ENABLED=true
CSRF_COOKIE_NAME=XSRF-TOKEN
SECURE_COOKIES=true
HTTP_STRICT_TRANSPORT_SECURITY=true
CONTENT_SECURITY_POLICY=default-src 'self'
X_FRAME_OPTIONS=DENY
X_CONTENT_TYPE_OPTIONS=nosniff

# Request Size Limits
MAX_REQUEST_SIZE=10mb
MAX_JSON_SIZE=1mb
MAX_URL_ENCODED_SIZE=1mb
MAX_MULTIPART_FILE_SIZE=100mb
MAX_MULTIPART_FIELD_SIZE=1mb

# Compression Configuration
COMPRESSION_ENABLED=true
COMPRESSION_LEVEL=6
COMPRESSION_THRESHOLD=1024

# Circuit Breaker Configuration
CIRCUIT_BREAKER_ENABLED=true
CIRCUIT_BREAKER_TIMEOUT=10000
CIRCUIT_BREAKER_ERROR_THRESHOLD=50
CIRCUIT_BREAKER_VOLUME_THRESHOLD=10
CIRCUIT_BREAKER_RESET_TIMEOUT=30000

# Load Balancing Configuration
LOAD_BALANCER_STRATEGY=round-robin
ENABLE_STICKY_SESSIONS=false
SESSION_AFFINITY_COOKIE=gateway-affinity

# Caching Configuration
CACHE_ENABLED=true
CACHE_TTL=300
CACHE_MAX_SIZE=100
CACHE_CONTROL_HEADER=public, max-age=300

# Request ID & Tracing
ENABLE_REQUEST_ID=true
REQUEST_ID_HEADER=X-Request-ID
PROPAGATE_REQUEST_ID=true

# API Versioning
API_VERSION_HEADER=X-API-Version
SUPPORT_LEGACY_VERSIONS=true
DEPRECATED_VERSION_WARNING=true

# Authentication & Authorization
REQUIRE_AUTHENTICATION=true
VALIDATE_JWT_ON_EVERY_REQUEST=true
AUTH_HEADER_NAME=Authorization
AUTH_SCHEME=Bearer

# Public Routes (No Authentication Required)
PUBLIC_ROUTES=/health,/ready,/alive,/api-docs,/swagger-ui
PUBLIC_ROUTE_PATTERNS=/auth/login,/auth/register,/auth/password-reset

# Role-Based Access Control
ENABLE_RBAC=true
DEFAULT_ROLE=beneficiary
ADMIN_ROUTES=/admin/*,/system/*
BROKER_ROUTES=/enrollments/*,/policies/*
HR_ROUTES=/employees/*,/bulk-enrollment/*

# Monitoring & Observability
ENABLE_METRICS=true
METRICS_PORT=9090
PROMETHEUS_ENABLED=true
JAEGER_ENDPOINT=http://jaeger:6831
SENTRY_DSN=your-sentry-dsn-here
ENABLE_APM=false
APM_SERVER_URL=http://apm-server:8200

# Health Check Configuration
HEALTH_CHECK_PATH=/health
READINESS_CHECK_PATH=/ready
LIVENESS_CHECK_PATH=/alive
HEALTH_CHECK_INCLUDE_SERVICES=true

# Logging Configuration
LOG_FORMAT=json
LOG_TIMESTAMP=true
LOG_REQUEST_HEADERS=false
LOG_RESPONSE_HEADERS=false
LOG_REQUEST_BODY=false
LOG_RESPONSE_BODY=false
LOG_SENSITIVE_FIELDS=password,token,secret,authorization
MASK_SENSITIVE_DATA=true

# Error Handling Configuration
INCLUDE_STACK_TRACE=false
ENABLE_ERROR_DETAILS=true
ERROR_MESSAGE_LANGUAGE=pt-BR
CUSTOM_ERROR_PAGES=true

# Timeout Configuration
GLOBAL_TIMEOUT=30000
AUTH_SERVICE_TIMEOUT=5000
ENROLLMENT_SERVICE_TIMEOUT=15000
HEALTH_SERVICE_TIMEOUT=20000
POLICY_SERVICE_TIMEOUT=10000
DOCUMENT_SERVICE_TIMEOUT=60000
PAYMENT_SERVICE_TIMEOUT=30000

# Retry Configuration
ENABLE_RETRY=true
RETRY_METHODS=GET,HEAD,OPTIONS
RETRY_STATUS_CODES=502,503,504
MAX_RETRY_ATTEMPTS=3
RETRY_DELAY=1000

# Webhook Configuration
WEBHOOK_TIMEOUT=10000
WEBHOOK_RETRY_ATTEMPTS=3
WEBHOOK_SIGNATURE_HEADER=X-Webhook-Signature
WEBHOOK_SECRET=your-webhook-secret-here

# API Documentation
SWAGGER_TITLE=AUSTA Onboarding API Gateway
SWAGGER_DESCRIPTION=Unified API Gateway for Pre-paid Health Plan Onboarding Portal
SWAGGER_VERSION=1.0.0
SWAGGER_TERMS_URL=https://austa.com.br/terms
SWAGGER_CONTACT_EMAIL=api@austa.com.br
SWAGGER_LICENSE=Proprietary

# Feature Flags
ENABLE_GRAPHQL=false
ENABLE_WEBSOCKETS=false
ENABLE_API_KEY_AUTH=false
ENABLE_OAUTH2=false
ENABLE_INTROSPECTION=false

# Development Configuration
ENABLE_DEBUG_ROUTES=false
ENABLE_MOCK_RESPONSES=false
BYPASS_AUTHENTICATION=false
DISABLE_RATE_LIMITING=false

# Azure Key Vault (Production)
AZURE_KEY_VAULT_URL=your-key-vault-url
AZURE_KEY_VAULT_JWT_SECRET_NAME=jwt-secret
AZURE_USE_MANAGED_IDENTITY=true

# LGPD Compliance
AUDIT_LOG_ENABLED=true
ANONYMIZE_LOGS=true
DATA_RESIDENCY=BR
CONSENT_TRACKING_ENABLED=true

# Performance Tuning
CLUSTER_MODE=false
WORKER_PROCESSES=auto
MAX_CONNECTIONS=1000
KEEP_ALIVE_TIMEOUT=65000
HEADER_TIMEOUT=60000

# SSL/TLS Configuration (Production)
SSL_ENABLED=false
SSL_CERT_PATH=/etc/ssl/certs/server.crt
SSL_KEY_PATH=/etc/ssl/private/server.key
SSL_CA_PATH=/etc/ssl/certs/ca.crt
TLS_MIN_VERSION=1.3
